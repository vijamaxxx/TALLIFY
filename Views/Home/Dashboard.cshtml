@model IEnumerable<ProjectTallify.Models.Event>

@{
    ViewData["Title"] = "Dashboard";
    ViewBag.ActiveNav = "Dashboard";
}

<link rel="stylesheet" href="~/css/dashboard-grid.css" asp-append-version="true" />

<section class="panel-section">
    <header class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2 class="panel-title">Dashboard</h2>
            <p class="panel-subtitle">
                Welcome back! Quick overview of your competitions.
            </p>
        </div>
        <button type="button"
                id="btnShowCreateEventModal"
                class="dashboard-create-event-custom"
                style="width: max-content; margin-bottom: 0;">
            Create Event
        </button>
    </header>
</section>

<div class="active-events-container">
    <h2 class="panel-title">Active Events</h2>
    <p class="events-section-subtitle">
        View, manage, and track all events in your organization.
    </p>

    @if (Model == null || !Model.Any())
    {
        <div class="empty-state-dashboard">
            <i class="ri-calendar-event-line empty-state-icon"></i>
            <h3 class="empty-state-title">No active events yet</h3>
            <p class="empty-state-subtext">Create an event to get started</p>
        </div>
    }
    else
    {
        <div class="events-grid">
            @foreach (var ev in Model)
            {
                var typeLabel = ev.EventType == "criteria" ? "CB" : "ORW";
                var typeClass = ev.EventType == "criteria" ? "pill-type-cb" : "pill-type-orw";
                
                var statusText = string.IsNullOrWhiteSpace(ev.Status) ? "Preparing" : ev.Status;
                
                // Header Background Logic
                string headerStyle = "background-color: #f3f4f6;"; // Default gray
                
                if (!string.IsNullOrEmpty(ev.HeaderImage))
                {
                    headerStyle = $"background-image: url('{Url.Content("~/uploads/" + ev.HeaderImage)}'); background-size: cover; background-position: center;";
                }
                else if (!string.IsNullOrEmpty(ev.ThemeColor))
                {
                    headerStyle = $"background-color: {ev.ThemeColor};";
                }

                // Date Badge Logic
                string dateBadgeMonth = ev.StartDateTime.ToString("MMM");
                string dateBadgeDay   = ev.StartDateTime.ToString("dd");
                
                <div class="event-card">
                    <!-- Banner Area -->
                    <div class="event-card-banner" style="@headerStyle">
                        <div class="event-date-badge">
                            <span class="badge-month">@dateBadgeMonth.ToUpper()</span>
                            <span class="badge-day">@dateBadgeDay</span>
                        </div>
                    </div>
                    
                    <!-- Content Body -->
                    <div class="event-card-body">
                        <h3 class="event-card-title">@ev.Name</h3>
                        <div class="event-card-tags">
                            <span class="pill @typeClass">@typeLabel</span>
                            <span class="pill" style="background:#dcfce7; color:#166534;">@statusText.ToUpper()</span>
                        </div>
                    </div>

                    <div class="event-card-footer">
                        <a href="/Events/Manage/@ev.Id" class="event-card-btn">
                            Manage
                        </a>
                    </div>
                </div>
            }
        </div>
    }
</div>

<!-- Modal Structure -->
<div class="modal fade" id="createEventRequirementsModal" tabindex="-1" aria-labelledby="createEventRequirementsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 16px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
      <div class="modal-header" style="border-bottom: 1px solid #f3f4f6; padding: 20px 24px;">
        <h5 class="modal-title" id="createEventRequirementsModalLabel" style="font-weight: 700; color: #111827;">Before You Start</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="padding: 24px;">
        <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
            To ensure a smooth event creation process, please have the following information ready:
        </p>
        
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <div style="display: flex; gap: 12px; align-items: flex-start;">
                <div style="background: #eff6ff; color: #2563eb; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="ri-file-info-line"></i>
                </div>
                <div>
                    <h6 style="margin: 0 0 4px; font-size: 14px; font-weight: 600; color: #374151;">Event Details</h6>
                    <p style="margin: 0; font-size: 13px; color: #6b7280;">Name, venue, description, date & time.</p>
                </div>
            </div>

            <div style="display: flex; gap: 12px; align-items: flex-start;">
                <div style="background: #f0fdf4; color: #16a34a; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="ri-user-smile-line"></i>
                </div>
                <div>
                    <h6 style="margin: 0 0 4px; font-size: 14px; font-weight: 600; color: #374151;">Contestants</h6>
                    <p style="margin: 0; font-size: 13px; color: #6b7280;">Names, organizations, and photos (optional).</p>
                </div>
            </div>

            <div style="display: flex; gap: 12px; align-items: flex-start;">
                <div style="background: #fff7ed; color: #ea580c; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="ri-list-check"></i>
                </div>
                <div>
                    <h6 style="margin: 0 0 4px; font-size: 14px; font-weight: 600; color: #374151;">Criteria & Rounds</h6>
                    <p style="margin: 0; font-size: 13px; color: #6b7280;">Scoring criteria percentages and round structure.</p>
                </div>
            </div>

            <div style="display: flex; gap: 12px; align-items: flex-start;">
                <div style="background: #fef2f2; color: #dc2626; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="ri-mail-send-line"></i>
                </div>
                <div>
                    <h6 style="margin: 0 0 4px; font-size: 14px; font-weight: 600; color: #374151;">Judges</h6>
                    <p style="margin: 0; font-size: 13px; color: #6b7280;">Valid email addresses for judge invitations (Required).</p>
                </div>
            </div>
        </div>
      </div>
      <div class="modal-footer" style="border-top: 1px solid #f3f4f6; padding: 16px 24px; background-color: #f9fafb; border-bottom-left-radius: 16px; border-bottom-right-radius: 16px;">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal" style="font-weight: 500; color: #374151;">Cancel</button>
        <button type="button" id="btnProceedToCreate" class="btn btn-primary" style="background-color: var(--color-primary); border: none; font-weight: 600;">Proceed to Create</button>
      </div>
    </div>
  </div>
</div>

<style>
    .dashboard-create-event-custom {
        width: 100%;
        border: 0;
        padding: 14px 24px;
        margin-bottom: 16px;
        background-color: var(--color-primary);
        color: #ffffff;
        font-size: 14px;
        font-weight: 600;
        box-shadow: none;
        border-radius: var(--radius-md); /* Assuming global var */
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .dashboard-create-event-custom:hover {
        opacity: 0.9;
    }
</style>

@section Scripts {
    <script src="~/js/app.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var modalEl = document.getElementById('createEventRequirementsModal');
            var modal = new bootstrap.Modal(modalEl);
            
            var btnShow = document.getElementById('btnShowCreateEventModal');
            if(btnShow) {
                btnShow.addEventListener('click', function(e) {
                    e.preventDefault();
                    modal.show();
                });
            }

            var btnProceed = document.getElementById('btnProceedToCreate');
            if(btnProceed) {
                btnProceed.addEventListener('click', function() {
                    window.location.href = '/Home/CreateEvent';
                });
            }
        });
    </script>
}
