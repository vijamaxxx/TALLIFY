@model ProjectTallify.Models.ReportViewModel

<div class="report-preview-container">
    
    <!-- Header Actions (Visible on screen, hidden on print) -->
    <div class="report-actions d-print-none" style="text-align: right; margin-bottom: 20px;">
        <button type="button" class="btn-primary" onclick="window.print()">
            <i class="ri-download-line"></i> Download PDF / Print
        </button>
    </div>

    <!-- Report Content -->
    <div class="report-content">
        
        <!-- 1. WINNERS -->
        @if (Model.SelectedReports.Contains("winners"))
        {
            <div class="report-section page-break">
                <div class="report-header">
                    <h1>@Model.Event.Name</h1>
                    <h2>Official Winners</h2>
                    <p>@Model.Event.Venue &bull; @Model.Event.StartDateTime.ToString("MMM dd, yyyy")</p>
                </div>

                <table class="app-table">
                    <thead>
                        <tr>
                            <th width="15%">Rank</th>
                            <th width="45%">Contestant</th>
                            <th width="40%">Organization</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.Winners)
                        {
                            <tr class="@(row.Rank >= 1 && row.Rank < 2 ? "winner-gold" : "")">
                                <td>
                                    @if(row.Rank >= 1 && row.Rank < 2) { <span>&#129351; @(row.Rank % 1 == 0 ? "1st" : row.Rank.ToString("0.##"))</span> } 
                                    else if(row.Rank >= 2 && row.Rank < 3) { <span>&#129352; @(row.Rank % 1 == 0 ? "2nd" : row.Rank.ToString("0.##"))</span> }
                                    else if(row.Rank >= 3 && row.Rank < 4) { <span>&#129353; @(row.Rank % 1 == 0 ? "3rd" : row.Rank.ToString("0.##"))</span> }
                                    else { <span>@row.Rank.ToString("0.##")</span> }
                                </td>
                                <td>@row.ContestantName</td>
                                <td>@row.Organization</td>
                            </tr>
                        }
                        @if(!Model.Winners.Any()) { <tr><td colspan="3">No winners declared yet.</td></tr> }
                    </tbody>
                </table>
                
                <div class="report-footer">
                    <p>Generated by Tallify</p>
                </div>
            </div>
        }

        <!-- 2. OVERALL TALLY -->
        @if (Model.SelectedReports.Contains("overall"))
        {
            <div class="report-section page-break">
                <div class="report-header">
                    <h1>@Model.Event.Name</h1>
                    <h2>Overall Tally</h2>
                    <p>@Model.Event.Venue &bull; @Model.Event.StartDateTime.ToString("MMM dd, yyyy")</p>
                </div>

                <table class="app-table">
                    <thead>
                        <tr>
                            <th width="10%">Rank</th>
                            <th width="40%">Contestant</th>
                            <th width="30%">Organization</th>
                            <th width="20%">Total Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.OverallScores)
                        {
                            <tr>
                                <td>@row.Rank</td>
                                <td>@row.ContestantName</td>
                                <td>@row.Organization</td>
                                <td>@row.TotalScore.ToString("F2")</td>
                            </tr>
                        }
                        @if(!Model.OverallScores.Any()) { <tr><td colspan="4">No scores yet.</td></tr> }
                    </tbody>
                </table>
                
                 <div class="report-footer">
                    <p>Generated by Tallify</p>
                </div>
            </div>
        }

        <!-- 2b. RESULT PER ROUND (Same data as Overall for now in Preview) -->
        @if (Model.SelectedReports.Contains("resultperround"))
        {
            <div class="report-section page-break">
                <div class="report-header">
                    <h1>@Model.Event.Name</h1>
                    <h2>Result Per Round</h2>
                    <p>@Model.Event.Venue &bull; @Model.Event.StartDateTime.ToString("MMM dd, yyyy")</p>
                </div>

                <table class="app-table">
                    <thead>
                        <tr>
                            <th width="10%">Rank</th>
                            <th width="40%">Contestant</th>
                            <th width="30%">Organization</th>
                            <th width="20%">Total Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.OverallScores)
                        {
                            <tr>
                                <td>@row.Rank</td>
                                <td>@row.ContestantName</td>
                                <td>@row.Organization</td>
                                <td>@row.TotalScore.ToString("F2")</td>
                            </tr>
                        }
                        @if(!Model.OverallScores.Any()) { <tr><td colspan="4">No scores yet.</td></tr> }
                    </tbody>
                </table>
                
                 <div class="report-footer">
                    <p>Generated by Tallify</p>
                </div>
            </div>
        }

        <!-- 3. SCORE SHEET / JUDGES SCORES -->
        @if (Model.SelectedReports.Contains("scoresheet") || Model.SelectedReports.Contains("judges"))
        {
            foreach(var round in Model.ScoreSheetRounds)
            {
                <div class="report-section page-break">
                    <div class="report-header">
                        <h1>@Model.Event.Name</h1>
                        <h2>Score Sheet - @round.RoundName</h2>
                        <p>@Model.Event.Venue &bull; @Model.Event.StartDateTime.ToString("MMM dd, yyyy")</p>
                    </div>

                    <table class="app-table small-text">
                        <thead>
                            <tr>
                                <th>Contestant</th>
                                @foreach(var j in round.Judges)
                                {
                                    <th>@j</th>
                                }
                                <th>Average</th>
                                <th>Rank</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var row in round.Rows)
                            {
                                <tr>
                                    <td>@row.ContestantName</td>
                                    @foreach(var s in row.JudgeScores)
                                    {
                                        <td>@s.ToString("F2")</td>
                                    }
                                    <td>@row.AverageScore.ToString("F2")</td>
                                    <td>@row.Rank</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    
                     <div class="report-footer">
                        <p>Generated by Tallify</p>
                    </div>
                </div>
            }
        }

    </div>
</div>

<style>
    /* Print-Specific Styles */
    @@media print {
        body * {
            visibility: hidden;
        }
        .report-preview-container, .report-preview-container * {
            visibility: visible;
        }
        .report-preview-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white;
            z-index: 9999;
        }
        .d-print-none {
            display: none !important;
        }
        .page-break {
            page-break-after: always;
            margin-bottom: 0;
            box-shadow: none;
            border-bottom: none;
        }
        .report-section {
            box-shadow: none;
            margin: 0;
            padding: 20px;
        }
    }

    /* Screen Preview Styles */
    .report-section {
        background: white;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-radius: 8px;
    }
    .report-header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #eee;
        padding-bottom: 20px;
    }
    .report-header h1 {
        margin: 0;
        font-size: 24px;
        color: #111;
    }
    .report-header h2 {
        margin: 5px 0;
        font-size: 18px;
        color: #555;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .winner-gold {
        background-color: #fffbeb;
    }
    .report-footer {
        margin-top: 40px;
        text-align: center;
        font-size: 12px;
        color: #999;
        border-top: 1px solid #eee;
        padding-top: 10px;
    }
    .small-text th, .small-text td {
        font-size: 11px;
        padding: 6px;
    }
</style>